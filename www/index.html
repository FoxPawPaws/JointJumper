<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no">
    <title >chrome easter egg: t-rex runner</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://www.gstatic.com/firebasejs/5.8.0/firebase.js"></script>
    <script src="firebase.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <style>
        canvas{
            border:1px solid #000000;
            background-color: #bad9fa;
        }
                /* The Modal (background) */
        .modal {
          display: none; /* Hidden by default */
          position: fixed; /* Stay in place */
          z-index: 1; /* Sit on top */
          left: 0;
          top: 0;
          width: 100%; /* Full width */
          height: 100%; /* Full height */
          overflow: auto; /* Enable scroll if needed */
          background-color: rgb(0,0,0); /* Fallback color */
          background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
        /* Modal Content/Box */
        .modal-content {
          background-color: #fefefe;
          margin: 15% auto; /* 15% from the top and centered */
          padding: 20px;
          border: 1px solid #888;
          width: 30%; /* Could be more or less, depending on screen size */
        }
        .centered{
            text-align: center;
        }
    </style> 
</head>
<body onload="startGame();">
    <!-- The Modal -->
    <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content centered">
        <h2>Our highest weekly scorer!</h2>
        <table style="width:100%">
          <tr>
            <th><h3>User</h3></th>
            <th><h3>Points</h3></th> 
          </tr>
          <tr>
            <td id="name1"></td>
            <td score="score1"></td> 
          </tr>
        </table>
        <div>
            <input id="name" type="text" name="Name" placeholder="Name" />
            <input id="email" type="text" name="Email Address" placeholder="Email" />
        </div>
        <button id="submit" type="button">Submit your score!</button>
        <button id="startOver" type="button">Start Over</button>
      </div>
    </div>

    <script type="text/javascript">
        minGap=400;
        maxGap=700;
        gap=randGap();
        bonusFlag= 0;
        jumpTemp=1;
        var myObstacles=[];
        var colours=["pigSprite","tempEvilSprite", "tempEvilSprite" ,"tempDankSprite"];
        
        function startGame(){
            gamearea.start();
        }    
        function gameOver(){
            var modal= document.getElementById('myModal');
            var button= document.getElementById('startOver');
            var span= document.getElementsByClassName("close")[0];
            modal.style.display= "block";
            
            button.onclick= function(){
                modal.style.display= "none";
                document.location.reload(true);
            }         
        }
        //upload score to Firebase if > top 5
       /* function upLoadScore(newScore){
            var button= document.getElementById('submit');
            database = firebase.database();
            firebaseRef= database().ref('1');

            ref.on('value', gotData, errData)
           
            //when submit button is clicked
            button.onclick= function(){
                if(newScore){
                    var name= document.getElementById('name').value;
                    var email= document.getElementById('email').value;
                   firebaseRef.child("name1").set(name);
                   firebaseRef.child("score1").set(newScore);
                }
                //set value of highest score to name 1 and score 1 from firebase
                //document.getElementById('name1').value= highScore.name1;
                //document.getElementById('score1').value= highScore.score1;

                
            }
        }*/
        function gotData(data){
           var scores = data.val();
           var keys = Object.keys(scores);
        }
        function errData(err){
            console.log("error!");
            console.log(err);
        }
        function everyinterval(n){
            if(gamearea.frame%n==0) return true;
            return false;
        }
        function jump(){
            if(jumpTemp==1){
               player.sourceX=240;
               player.speedY-=6;
               jumpTemp=0;
            }
        }
        function randGap(){
            return Math.floor(minGap+Math.random()*(maxGap=minGap+1));
        }
        var scoreText={
            x:900,
            y:50,
            update:function(text){
                gamearea.context.fillStyle="gray";
                gamearea.context.font="30px Consolas";
                if(bonusFlag){
                 gamearea.context.fillText("BONUS: + 100", this.x,this.y);
                 gamearea.score+=1;
                 bonusFlag=0;
                }else{
                gamearea.context.fillText(text,this.x,this.y);}
            }
        }
        var player={
            sourceX:0,
            x:35,
            y:420,
            speedY:0,
            update:function(){
                gamearea.context.fillStyle="black";
                playerSprite = new Image();
                playerSprite.src='assets/playerSprite.png';
                gamearea.context.drawImage(playerSprite,this.sourceX,0,60,80,this.x,this.y,55,80);
            },
            newPos:function(){
                if(jumpTemp==0){ 
                    this.speedY+=0.04;
                    this.y += this.speedY;
                    this.speedY *=0.97;
                }
                if(this.y<100){
                    this.speedY=0;
                }
                this.y=this.y+this.speedY;
                if(this.y>=420){
                    this.speedY=0;
                    this.y=420;
                    if(jumpTemp==0){
                       player.sourceX=0; 
                    }
                    jumpTemp=1;
                }
            },
            newSprite:function(){
                if(((gamearea.frame+1) % 25 === 1) && jumpTemp==1){
                    if(this.sourceX==180){
                        this.sourceX=0;
                    }else{
                        this.sourceX+=60;
                    }
                }
            },
            crashWith:function(obs){
                if(this.x+45>obs.x &&this.x<obs.x+obs.width && this.y+60>obs.y){
                    if(obs.index == 3){
                        bonusFlag =1;
                        return false;
                    }return true;
                }
                return false;
            }
        }
        function obstacle(){
            this.sourceX=0;
            this.height=78;
            this.width=55;
            this.x=1200;
            this.y=gamearea.canvas.height-this.height;
            this.index=Math.floor(Math.random()*colours.length);
            this.color=colours[this.index];
            this.draw=function(){
               if((gamearea.frame+1) % 40 === 1){
                    if(this.sourceX==60){
                        this.sourceX=0;
                    }else{
                        this.sourceX+=60;
                    }
                }
                obsSprite = new Image();
                obsSprite.src='assets/'+colours[this.index]+'.png';
                gamearea.context.drawImage(obsSprite,this.sourceX,0,60,80,this.x,this.y,this.width,this.height);
            }
        }

        var gamearea={
            canvas:document.createElement("canvas"),
            start:function(){
               this.canvas.id="canvasID";
               this.canvas.height=500;
               this.canvas.width=1200;
               document.body.insertBefore(this.canvas,document.body.childNodes[0]);
               this.context=this.canvas.getContext("2d");
               this.frame=0;
               this.score=0;
               this.jointScore=0; // joint score
               this.interval=setInterval(this.updateGameArea,5);
               window.addEventListener("keydown",jump);
            },
            updateGameArea:function(){
                for(i=0;i<myObstacles.length; i++){
                    if(player.crashWith(myObstacles[i])){
                        gamearea.stop();
                        return
                    }
                }
                gamearea.clear();
                if(everyinterval(gap)){
                    myObstacles.push(new obstacle());
                    gap=randGap();
                    gamearea.frame=0;
                }
                for(i=0;i<myObstacles.length;i++){
                    myObstacles[i].x-=1;
                    myObstacles[i].draw();
                }
                player.newPos();
                player.newSprite();
                player.update();
                gamearea.frame+=1;
                gamearea.score+=0.01;
                scoreText.update("Score: "+Math.floor(gamearea.score));
            },
            clear:function(){
                gamearea.context.clearRect(0,0,this.canvas.width,this.canvas.width);
            },
            stop:function(){
                //upLoadScore(Math.floor(gamearea.score));
                gameOver();
                clearInterval(this.interval);
            }
        }
    </script>
</body>
</html>
